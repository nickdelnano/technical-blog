<!DOCTYPE html>
<html lang="en-us">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>AWS Lake Formation with Self Hosted Query Engines | My New Hugo Site</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="Lake Formation is a neat service that provides a better authorization abstraction for data lake objects than IAM. What do I mean by &ldquo;better&rdquo;?

Friendlier for data related roles (analysts, data engineers, data scientists, etc) to understand and use

These roles work with data lake table names. They don&rsquo;t care about S3 paths.


Possible to audit permissions.  aws lake formation list-permissions replaces &hellip; parsing IAM policies?


Lake Formation provides its own permissions model that augments the IAM permissions model. Lake Formation permissions model enables fine-grained access to data stored in data lakes through a simple grant or revoke mechanism, much like a relational database management system (RDBMS).
https://docs.aws.amazon.com/lake-formation/latest/dg/what-is-lake-formation.html">
    <meta name="generator" content="Hugo 0.138.0">
    
    
    
      <meta name="robots" content="noindex, nofollow">
    
    

    
<link rel="stylesheet" href="/ananke/css/main.min.css" >



    

    
      

    

    

    
      <link rel="canonical" href="http://localhost:1313/posts/aws-lake-formation-self-hosted-engines/">
    

    <meta property="og:url" content="http://localhost:1313/posts/aws-lake-formation-self-hosted-engines/">
  <meta property="og:site_name" content="My New Hugo Site">
  <meta property="og:title" content="AWS Lake Formation with Self Hosted Query Engines">
  <meta property="og:description" content="Lake Formation is a neat service that provides a better authorization abstraction for data lake objects than IAM. What do I mean by “better”?
Friendlier for data related roles (analysts, data engineers, data scientists, etc) to understand and use These roles work with data lake table names. They don’t care about S3 paths. Possible to audit permissions. aws lake formation list-permissions replaces … parsing IAM policies? Lake Formation provides its own permissions model that augments the IAM permissions model. Lake Formation permissions model enables fine-grained access to data stored in data lakes through a simple grant or revoke mechanism, much like a relational database management system (RDBMS). https://docs.aws.amazon.com/lake-formation/latest/dg/what-is-lake-formation.html">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-09-15T00:00:00-08:00">
    <meta property="article:modified_time" content="2024-09-15T00:00:00-08:00">

  <meta itemprop="name" content="AWS Lake Formation with Self Hosted Query Engines">
  <meta itemprop="description" content="Lake Formation is a neat service that provides a better authorization abstraction for data lake objects than IAM. What do I mean by “better”?
Friendlier for data related roles (analysts, data engineers, data scientists, etc) to understand and use These roles work with data lake table names. They don’t care about S3 paths. Possible to audit permissions. aws lake formation list-permissions replaces … parsing IAM policies? Lake Formation provides its own permissions model that augments the IAM permissions model. Lake Formation permissions model enables fine-grained access to data stored in data lakes through a simple grant or revoke mechanism, much like a relational database management system (RDBMS). https://docs.aws.amazon.com/lake-formation/latest/dg/what-is-lake-formation.html">
  <meta itemprop="datePublished" content="2024-09-15T00:00:00-08:00">
  <meta itemprop="dateModified" content="2024-09-15T00:00:00-08:00">
  <meta itemprop="wordCount" content="507">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="AWS Lake Formation with Self Hosted Query Engines">
  <meta name="twitter:description" content="Lake Formation is a neat service that provides a better authorization abstraction for data lake objects than IAM. What do I mean by “better”?
Friendlier for data related roles (analysts, data engineers, data scientists, etc) to understand and use These roles work with data lake table names. They don’t care about S3 paths. Possible to audit permissions. aws lake formation list-permissions replaces … parsing IAM policies? Lake Formation provides its own permissions model that augments the IAM permissions model. Lake Formation permissions model enables fine-grained access to data stored in data lakes through a simple grant or revoke mechanism, much like a relational database management system (RDBMS). https://docs.aws.amazon.com/lake-formation/latest/dg/what-is-lake-formation.html">

	
  </head><body class="ma0 avenir bg-near-white development">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        My New Hugo Site
      
    </a>
    <div class="flex-l items-center">
      

      
      <div class="ananke-socials"></div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Posts
      </aside><div id="sharing" class="mt3 ananke-socials"></div>
<h1 class="f1 athelas mt3 mb1">AWS Lake Formation with Self Hosted Query Engines</h1>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2024-09-15T00:00:00-08:00">September 15, 2024</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p>Lake Formation is a neat service that provides a better authorization abstraction for data lake objects than IAM. What do I mean by &ldquo;better&rdquo;?</p>
<ul>
<li>Friendlier for data related roles (analysts, data engineers, data scientists, etc) to understand and use
<ul>
<li>These roles work with data lake table names. They don&rsquo;t care about S3 paths.</li>
</ul>
</li>
<li>Possible to audit permissions.  <em>aws lake formation list-permissions</em> replaces &hellip; parsing IAM policies?</li>
</ul>
<blockquote>
<p>Lake Formation provides its own permissions model that augments the IAM permissions model. Lake Formation permissions model enables fine-grained access to data stored in data lakes through a simple grant or revoke mechanism, much like a relational database management system (RDBMS).
<a href="https://docs.aws.amazon.com/lake-formation/latest/dg/what-is-lake-formation.html">https://docs.aws.amazon.com/lake-formation/latest/dg/what-is-lake-formation.html</a></p>
</blockquote>
<p>With Lake Formation, IAM permissions on S3 (data) and Glue (metadata) resources become <em>GRANT</em> statements. If you have managed IAM change management in an enterprise, or even if you have written an IAM policy just one time, this will be a welcome change to you.</p>
<p>Bringing data lake permissions into the data world is a huge value add for the triad of data users, the data platform team and a security organization. <em>But there are prerequisites, and hopefully your deployment meets them. If not, then maybe this post will help you.</em></p>
<h2 id="query-engine-compatibility">Query Engine Compatibility</h2>
<p>To enable <a href="https://docs.aws.amazon.com/lake-formation/latest/dg/how-it-works.html">Lake Formation&rsquo;s implementation</a>, it requires using <a href="https://docs.aws.amazon.com/lake-formation/latest/dg/service-integrations.html">AWS hosted query engines</a>. If you are self hosting your query engine, or if you are using an engine not supported in Lake Formation, you can implement the <a href="https://docs.aws.amazon.com/lake-formation/latest/dg/using-cred-vending.html">credential vending API</a>. It is possible – <a href="https://docs.starburst.io/latest/security/aws-lake-formation.html">vendors</a> in the space have done this – but what if you don&rsquo;t want to, or you simply want an open source solution?</p>
<h2 id="expanded-compatibility-with-apache-iceberg">Expanded Compatibility with Apache Iceberg</h2>
<p>Enter Iceberg&rsquo;s <a href="https://github.com/apache/iceberg/blob/main/aws/src/main/java/org/apache/iceberg/aws/lakeformation/LakeFormationAwsClientFactory.java#L51">LakeFormationAwsClientFactory</a> class.</p>
<p>This was <a href="https://github.com/apache/iceberg/pull/4280">contributed by AWS</a> &ndash; plausibly for use with their query engine services &ndash; but it works in the case of a single party. See example configuration <a href="https://github.com/apache/iceberg/issues/10226">here</a>.</p>
<p>Now you can integrate any Iceberg compatible query engine with Lake Formation permissions. For my case this was open source Spark and Flink.</p>
<p>There is an important limitation:  Lake Formation row and column security policies cannot be securely applied. As part of the <a href="https://docs.aws.amazon.com/lake-formation/latest/dg/roles-and-responsibilities.html">credential vending contract</a>, the third-party must not leak credentials and must return only filtered data to users. This is not applicable in this case since there is only one party and the application will access the credentials. If this limitation is not a blocker for you, then you can enjoy Lake Formation support in all of your query engines.</p>
<h2 id="addendum">Addendum</h2>
<p>The Lake Formation implementation in Iceberg does not work to create tables. The integration test in the repo fails (and is not run on CI? Probably because it requires an AWS account with broad permissions on the IAM service).</p>
<p>I&rsquo;ve filed <a href="https://github.com/apache/iceberg/issues/10226">issue #10226</a> about this.</p>
<p>This can be worked around by</p>
<ul>
<li>Creating a table using Glue APIs. My use-case is for client IAMs to have no S3 permissions and only Lake Formation grants, so I use <code>glue create-table</code> with <code>--open-table-format-input</code>. See <a href="https://docs.aws.amazon.com/lake-formation/latest/dg/creating-iceberg-tables.html">here</a>.</li>
<li>Creating a separate catalog instance without the Lake Formation properties and run DDL through this catalog.</li>
</ul>
<ul class="pa0">
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="http://localhost:1313/" >
    &copy;  My New Hugo Site 2024 
  </a>
    <div><div class="ananke-socials"></div>
</div>
  </div>
</footer>

  </body>
</html>
